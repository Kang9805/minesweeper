{% for row in board_data %}
    {% for cell in row %}
        {% if cell.is_revealed %}
            <div class="cell revealed {% if cell.is_mine %}mine{% endif %} {% if cell.value %}color-{{ cell.value }}{% endif %}">
                {% if cell.is_mine %}ğŸ’£{% else %}{{ cell.value }}{% endif %}
            </div>
        {% else %}
            <div class="cell {% if cell.is_flagged %}flagged{% endif %}"
                 data-row="{{ cell.row }}"
                 data-col="{{ cell.col }}"
                 hx-get="{% url 'click' cell.row cell.col %}"
                 hx-target="#game-board"
                 hx-swap="innerHTML">
                {% if cell.is_flagged %}ğŸš©{% endif %}
            </div>
        {% endif %}
    {% endfor %}
{% endfor %}

<style>
    .cell {
        user-select: none;
        -webkit-user-select: none;
        -webkit-touch-callout: none;
        -moz-user-select: none;
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const cells = document.querySelectorAll('.cell:not(.revealed)');
    
    cells.forEach(cell => {
        let pressTimer;
        let isLongPress = false;
        
        // ë¡±í”„ë ˆìŠ¤ ì‹œì‘
        cell.addEventListener('touchstart', function(e) {
            isLongPress = false;
            pressTimer = setTimeout(() => {
                isLongPress = true;
                e.preventDefault();
                
                // ê¹ƒë°œ í† ê¸€
                const row = cell.dataset.row;
                const col = cell.dataset.col;
                htmx.ajax('GET', `/flag/${row}/${col}/`, {
                    target: '#game-board',
                    swap: 'innerHTML'
                });
            }, 500);
        }, { passive: true });
        
        // ë¡±í”„ë ˆìŠ¤ ì·¨ì†Œ (í„°ì¹˜ ì´ë™)
        cell.addEventListener('touchmove', function() {
            clearTimeout(pressTimer);
            isLongPress = false;
        }, { passive: true });
        
        // ë¡±í”„ë ˆìŠ¤ ì¢…ë£Œ
        cell.addEventListener('touchend', function(e) {
            clearTimeout(pressTimer);
            // ë¡±í”„ë ˆìŠ¤ ì„±ê³µí–ˆìœ¼ë©´ ì¼ë°˜ í´ë¦­ ë°©ì§€
            if (isLongPress) {
                e.preventDefault();
            }
        }, { passive: true });
        
        // PC ìš°í´ë¦­
        cell.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            const row = cell.dataset.row;
            const col = cell.dataset.col;
            htmx.ajax('GET', `/flag/${row}/${col}/`, {
                target: '#game-board',
                swap: 'innerHTML'
            });
        });
    });
});
</script>